# üìÅ The Grand Tour Gamble ‚Äî App Structure & Best Practices

This document outlines the **recommended folder and file structure** for implementing The Grand Tour Gamble game in a **Next.js (App Router) + Supabase + MDX** project inside Cursor. It also includes **responsibilities**, **rules**, and **best practices** to ensure a smooth, scalable build.

---

## üì¶ Root Directory Structure

```
/app
  /admin                   # Admin page: session creation, trainer auth
  /trainer                 # Trainer dashboard (after session creation)
  /game                    # Player-facing game UI
  /negotiation             # Optional negotiation route (UI overlay)
  /reflection              # Optional post-stage reflection state
  /debrief                 # Post-game summary view
  /rules                   # MD content: game rules, scoring, penalties
  /history                 # Cyclist backstories, game lore
  /login                   # Shared login page (players & trainer access)

/components
  /common                  # Reusable UI elements (Button, Modal, etc.)
  /player                  # Cyclist view components (actions, stats)
  /trainer                 # Stage controller, scoreboard, game controls
  /admin                   # Session creation, code gen, team setup
  /game                    # Game engine UIs: map, events, synergy meter
  /scoreboard              # Team + individual scoreboards (shared)
  /modals                  # Backstory, rules, stage summary popups

/public                    # All .md files: rules, stages, cyclist bios

/types
  db.ts                    # Supabase DB types
  game.ts                  # Game logic interfaces (Cyclist, Stage, etc.)

/hooks
  useSupabaseUser.ts       # Auth logic
  useGameState.ts          # Stage + decision state syncing

/context
  GameContext.tsx          # Global shared state (trainer/player/stage)

/lib
  supabase.ts              # Supabase client init
  edge-functions.ts        # Edge function logic + triggers
  utils.ts                 # Game logic helpers (stamina, synergy, etc)

/edge-functions
  calculateStageResults.ts # Scoring engine run post-stage

/styles
  globals.css              # Tailwind/global styles
  tailwind.config.js       # Tailwind config
```

---

## üìÇ Folder Responsibilities

| Folder                | Responsibility Description                                           |
| --------------------- | -------------------------------------------------------------------- |
| `/admin`              | Session creator: session ID, team name, and start session trigger    |
| `/trainer`            | Trainer dashboard: lock/unlock decisions, see all scores             |
| `/game`               | Player UI: character, stage view, Sprint/Cruise selection            |
| `/components/admin`   | UI blocks for session creator (buttons, input, display trainer code) |
| `/components/game`    | Stage renderer, decision buttons, synergy meter                      |
| `/components/player`  | Cyclist card, backstory popup, scoreboard preview                    |
| `/components/trainer` | Stage control panel, scoreboard controller, timer toggle             |
| `/public`      | All rules, stages, bios, negotiation text in `.md` format            |
| `/types`              | Shared types across game: Cyclist, Decision, Team, Session           |
| `/edge-functions`     | Server-side scoring logic via Supabase Edge Functions                |

---

## ‚úÖ Best Practices

| Best Practice                   | Why It Matters                                                     |
| ------------------------------- | ------------------------------------------------------------------ |
| Use .md + .txt for logic feeds  | Makes Cursor AI clean, predictable, and easy to prompt             |
| Lock schema before build        | Avoid mismatched tables or retrofitting logic                      |
| Mock Supabase responses first   | Makes front-end dev faster without relying on backend availability |
| Keep UI split by role           | Easier for dev + AI to reason: player, trainer, admin              |
| Load markdown after logic loads | Prevents component errors on page load                             |
| Cursor prompt scope = 1 feature | One file, one prompt. Reduce AI hallucination risk                 |
| Avoid async loops with state    | Prevent unwanted re-renders or infinite useEffect calls            |

---

This structure and logic is designed to keep your Cursor implementation modular, fast, and production-grade.

